# name: test/sql/read_otlp_edge_cases.test
# description: test edge cases for OTLP readers (NULL values, empty files, minimal records)
# group: [sql]

require otlp

### NULL and Missing Value Handling ###

# Test traces with minimal required fields only
query I
SELECT COUNT(*)
FROM read_otlp_traces('test/data/traces_nulls.jsonl');
----
3

# Test traces with NULL parent span
query I
SELECT COUNT(*) FROM read_otlp_traces('test/data/traces_nulls.jsonl')
WHERE parent_span_id IS NULL;
----
3

# Test traces with NULL scope name
query I
SELECT COUNT(*) FROM read_otlp_traces('test/data/traces_nulls.jsonl')
WHERE scope_name IS NULL;
----
3

# Test logs with minimal fields
query I
SELECT COUNT(*)
FROM read_otlp_logs('test/data/logs_nulls.jsonl');
----
3

# Test logs with empty trace context
query I
SELECT COUNT(*) FROM read_otlp_logs('test/data/logs_nulls.jsonl')
WHERE trace_id IS NULL AND span_id IS NULL;
----
3

# Test logs with zero severity
query I
SELECT COUNT(*) FROM read_otlp_logs('test/data/logs_nulls.jsonl')
WHERE severity_number = 0;
----
1

# Test logs with NULL body
query I
SELECT COUNT(*) FROM read_otlp_logs('test/data/logs_nulls.jsonl')
WHERE body IS NULL;
----
1

### Empty and Whitespace Files ###

# Test empty file handling - returns 0 rows
query I
SELECT COUNT(*) FROM read_otlp_traces('test/data/empty.jsonl');
----
0

# Test whitespace-only file handling - errors (invalid content)
statement error
SELECT COUNT(*) FROM read_otlp_traces('test/data/whitespace.jsonl');
----

### Single Record Files ###

# Test single trace record
query I
SELECT COUNT(*) FROM read_otlp_traces('test/data/single_trace.jsonl');
----
1

# Verify single trace content
query II
SELECT trace_id, span_name
FROM read_otlp_traces('test/data/single_trace.jsonl');
----
00000000000000000000000000000001	single_span

### Typed Metrics with NULL Values ###

# Test gauge helper with minimal data
query I
SELECT COUNT(*) FROM read_otlp_metrics_gauge('test/data/metrics_nulls.jsonl');
----
1

# Test sum helper
query I
SELECT COUNT(*) FROM read_otlp_metrics_sum('test/data/metrics_nulls.jsonl');
----
1
