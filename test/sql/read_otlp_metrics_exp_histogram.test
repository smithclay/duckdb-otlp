# name: test/sql/read_otlp_metrics_exp_histogram.test
# description: verify read_otlp_metrics_exp_histogram table function
# group: [sql]

require otlp

# Test basic query and row count
query I
SELECT COUNT(*) FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
1

# Test metric name
query I
SELECT metric_name FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
latency.exp

# Test scale value
query I
SELECT scale FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
3

# Test count value
query I
SELECT count FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
12

# Test zero_count value
query I
SELECT zero_count FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
1

# Test sum value
query R
SELECT sum FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
45.5

# Test min/max values
query RR
SELECT min, max FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
1.0	9.5

# Test bucket offsets
query II
SELECT positive_offset, negative_offset FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
2	-1

# Test service_name extraction
query I
SELECT service_name FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
test-service

# Test metric_unit
query I
SELECT metric_unit FROM read_otlp_metrics_exp_histogram('test/data/metrics_all_types.jsonl');
----
ms

# Test empty result for gauge-only data
query I
SELECT COUNT(*) FROM read_otlp_metrics_exp_histogram('test/data/metrics_simple.jsonl');
----
0

# Test empty result for logs data
query I
SELECT COUNT(*) FROM read_otlp_metrics_exp_histogram('test/data/logs_simple.jsonl');
----
0
