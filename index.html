<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuckDB OTLP Extension Demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-min-noconflict/ace.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-min-noconflict/mode-sql.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.0/src-min-noconflict/theme-chrome.js"></script>
</head>
<body>
    <main class="container">
        <hgroup>
            <h1>DuckDB OTLP Extension Demo</h1>
            <p>Query OpenTelemetry data with SQL in your browser</p>
        </hgroup>

        <article id="status" class="hidden">
            <span id="status-text">Initializing...</span>
        </article>

        <article>
            <h2>1. Data Available</h2>
            <p><small>Sample files are preloaded and ready to query:</small></p>
            <ul>
                <li><code>traces.jsonl</code> / <code>traces.pb</code> - OpenTelemetry trace spans</li>
                <li><code>logs.jsonl</code> / <code>logs.pb</code> - OpenTelemetry log records</li>
                <li><code>metrics.jsonl</code> / <code>metrics.pb</code> - OpenTelemetry metrics (gauge, sum, histogram)</li>
            </ul>
            <details>
                <summary>Upload Your Own OTLP File (Optional)</summary>
                <input type="file" id="file-upload" accept=".jsonl,.json,.pb" disabled>
                <small>Supports JSON, JSONL, and Protobuf formats</small>
                <div id="loaded-file" class="hidden">
                    <strong>Loaded:</strong> <span id="loaded-file-name"></span>
                </div>
            </details>
        </article>

        <article>
            <h2>2. Write Your Query</h2>
            <p><small>Quick Examples:</small></p>
            <div role="group">
                <button class="example-btn secondary" data-query="SELECT * FROM read_otlp_traces('traces.jsonl') LIMIT 10;">Traces (JSON)</button>
                <button class="example-btn secondary" data-query="SELECT * FROM read_otlp_traces('traces.pb') LIMIT 10;">Traces (Protobuf)</button>
                <button class="example-btn secondary" data-query="SELECT span_name, duration, status_code FROM read_otlp_traces('traces.jsonl') ORDER BY duration DESC LIMIT 10;">Slowest spans</button>
                <button class="example-btn secondary" data-query="SELECT metric_name, metric_unit, value FROM read_otlp_metrics_gauge('metrics.jsonl');">Metrics: Gauge</button>
                <button class="example-btn secondary" data-query="SELECT severity_text, COUNT(*) as count FROM read_otlp_logs('logs.jsonl') GROUP BY severity_text ORDER BY count DESC;">Logs by severity</button>
            </div>
            <div id="sql-editor"></div>
            <button id="run-query" disabled>Run Query</button>
        </article>

        <article>
            <h2>3. Results</h2>
            <div id="results-placeholder">
                <p><em>Query results will appear here</em></p>
            </div>
            <div id="results-table-container" class="hidden">
                <p><small id="results-info"></small></p>
                <figure>
                    <table id="results-table" role="grid">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </figure>
            </div>
            <div id="results-error" class="hidden"></div>
        </article>

        <footer>
            <p>
                <small>
                    Built with <a href="https://duckdb.org" target="_blank">DuckDB</a> and
                    <a href="https://opentelemetry.io" target="_blank">OpenTelemetry</a>
                    â€¢ <a href="https://github.com/smithclay/duckdb-otlp" target="_blank">View on GitHub</a>
                </small>
            </p>
            <p><small>All processing happens client-side in your browser</small></p>
        </footer>
    </main>

    <script type="module" src="app.js"></script>
</body>
</html>
