extension:
  name: otlp
  description: Read OpenTelemetry metrics, logs and traces from JSON or protobuf with a ClickHouse-inspired schema
  version: 0.3.0
  language: C++
  build: cmake
  license: MIT
  # needed for protobuf
  vcpkg_commit: 35c82bb582adab830e1d14f9c4100d251b30aff4
  excluded_platforms: ""
  maintainers:
    - smithclay

repo:
  github: smithclay/duckdb-otlp
  ref: 37754c54f7fa371dcfec2b1312dd88c2def2c061

docs:
  hello_world: |
    -- Load the extension
    LOAD otlp;

    -- Read OTLP traces from a JSON file
    SELECT trace_id, span_name, service_name, duration
    FROM read_otlp_traces('traces.jsonl')
    WHERE duration > 1000000000
    LIMIT 10;

    -- Read gauge metrics
    SELECT timestamp, service_name, metric_name, value
    FROM read_otlp_metrics_gauge('metrics.jsonl')
    ORDER BY timestamp DESC;

    -- Filter logs by severity while reading from S3
    SELECT timestamp, severity_text, body, service_name
    FROM read_otlp_logs('s3://bucket/logs-*.jsonl')
    WHERE severity_text = 'ERROR';

    -- Read protobuf format
    SELECT * FROM read_otlp_traces('traces.pb') LIMIT 10;

  extended_description: |
    # OpenTelemetry for DuckDB

    Query OpenTelemetry data with SQL using ClickHouse-compatible strongly-typed schemas.
    Works with OTLP data exported from the OpenTelemetry collector's File Exporter.

    ## Features

    **OTLP File Reading**
    - Table functions: `read_otlp_traces()`, `read_otlp_logs()`, `read_otlp_metrics_*()`
    - Auto-detects JSON (`.json`, `.jsonl`) and protobuf (`.pb`) formats
    - Works with DuckDB file systems: local, S3, HTTP, Azure, GCS
    - Browser support via DuckDB-WASM (JSON and protobuf)

    **Strongly-Typed Schemas**
    - No JSON extraction required - all fields are proper DuckDB columns
    - Direct access: `service_name`, `trace_id`, `duration`, `value`, etc.
    - Compatible with OpenTelemetry ClickHouse exporter schema
    - Efficient filtering and aggregation on typed columns

    **Metric Type Functions**
    - Separate functions for each metric type: `read_otlp_metrics_gauge()`, `read_otlp_metrics_sum()`, `read_otlp_metrics_histogram()`, `read_otlp_metrics_exp_histogram()`
    - Each function returns a strongly-typed schema specific to that metric type

    ## Use Cases

    - **Observability Analysis**: Query traces, logs, and metrics from exported OTLP data
    - **OTLP File Processing**: Read and analyze OTLP exports from collectors or SDKs
    - **Data Pipeline Testing**: Validate telemetry data before shipping to production
    - **Local Development**: Collect and inspect OpenTelemetry data during development
    - **Data Transformation**: Export to Parquet, CSV, or other DuckDB-supported formats

    ## Architecture

    - **Table Functions**: `read_otlp_*` emit typed `DataChunk`s for traces, logs, and metrics
    - **Format Detection**: Sniffs the stream and dispatches to JSON or protobuf parsers
    - **Row Builders**: Shared conversion helpers produce ClickHouse-compatible column layouts
    - **Protobuf Stubs**: Generated OTLP message classes ship in `src/generated/`

    ## Limitations

    - Large protobuf files are processed batch-by-batch; continuous streaming is not yet supported

    ## References

    - [OpenTelemetry Protocol (OTLP)](https://opentelemetry.io/docs/specs/otlp/)
    - [OpenTelemetry ClickHouse Exporter](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/clickhouseexporter)
